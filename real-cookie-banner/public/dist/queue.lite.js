var realCookieBanner_queue;(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=devowlWp_utils,n=devowlWp_realQueue,o=["sitemap.xml","sitemap_index.xml","sitemap-index.xml","sitemap/","post-sitemap.xml","sitemap/sitemap.xml","sitemap/index.xml","sitemapindex.xml","sitemap.php","sitemap.txt","index.php/sitemap_index.xml","index.php?xml_sitemap=params=","glossar/sitemap.xml"];async function r(e,t=o){const n=t.map(t=>fetch(`${e}${t}`,{mode:"no-cors"}));for(const e of n)try{const t=await e,n=await t.text();if(n.indexOf("<sitemapindex")>-1||n.indexOf("<urlset")>-1)return t.url}catch(e){}return!1}const a=/.+?:\/\/.+?(\/.+?)(?:#|\?(.*)|$)/;function s(e,t,n=""){const o=e.match(a)?.[1]||"/",r=t.match(a);if(r){const[,t,a]=r,s=a?`?${a}${n?`?${n}`:""}`:n?`?${n}`:"";return`${e}${t.substr(o.length)}${s}`}return!1}async function i(e,t,n){try{const o=[];t&&o.push(`${t}=1`);const r=await fetch(`${e}robots.txt${o?`?${o}`:""}`);if(!r.ok)return!1;n&&o.push(`sitemap-crawler-filter=${n}`);const a=[...(await r.text()).matchAll(/^sitemap:(.*)$/gim)].map(([,e])=>e.trim());let i=[];for(const t of a){const r=s(e,t,o.join("&"));if(r){const e=await fetch(r);if(!e.ok)continue;const t=await e.text();if(!/<(?:sitemap|urlset)/gm.test(t))continue;if(n&&"false"===e.headers.get("X-Sitemap-Crawler-Filter"))continue;i.push(r)}}return i=[...new Set(i)],!!i.length&&i}catch(e){return!1}}const c="https://base";async function l(e,t,n){if(n)try{const o=await async function(e){const t=await fetch(e),n=await t.text();return(new DOMParser).parseFromString(n.trim(),"application/xml")}(t),{protocol:r}=new URL(t,c),a=o.querySelector("sitemapindex");if(a){const t=Array.from(a.children).map(e=>e.querySelector("loc")?.textContent).filter(Boolean);for(const o of t){const t=s(e,o)||o;await l(e,t,n)}}const i=o.querySelector("urlset");if(i){const e=Array.from(i.children).map(e=>e.querySelector("loc")?.textContent).filter(Boolean).map(e=>{try{const t=new URL(e,c);return"http:"===t.protocol&&(t.protocol=r),t.toString()}catch(t){return e}});n.push(...e)}}catch(e){console.error(`Error occurred during "crawl('${t}')":\n\r Error: ${e}`)}else try{return(await l(e,t,[])).sort((e,t)=>e.length-t.length)}catch(e){return console.error(e),[]}return[...new Set(n)]}let u;const p=(...e)=>(u||(u=(0,t.createLocalizationFactory)(t.BaseOptions.getPureSlug("real-cookie-banner")))).__(...e);async function d(e){const t=p('If you think a sitemap exists but you get this error, please <a href="%s" target="_blank" />contact our support</a> and we will look individually where the problem is in your WordPress installation.',p("https://devowl.io/support/"));let n=window.realCookieBannerQueue.originalHomeUrl;const o=window.realCookieBannerQueue.blogId;[n]=n.split("?",2),e?.("find-sitemap");const a=await function(e,t,n,o){return new Promise((a,s)=>{const c=e=>setTimeout(()=>a(e),100);(async()=>{try{const a=await i(e,void 0,o);if(a)return void c(a);const s=await r(e);if(s)return void c([s]);if(t){const n=await i(e,t,o);if(n)return void c(n)}if(n){const t=await r(e,n);if(t)return void c([t])}c(!1)}catch(e){s(e)}})()})}(n,"rcb-force-sitemap",["?sitemap=index&rcb-force-sitemap=1"],`${o}`);if(!1===a)throw new Error(`${p("We didn't find a sitemap on your website. We need it to scan all the subpages of your website. Do you have this feature disabled in your WordPress?")} ${t}`);e?.("collect-sitemap");let s=[];try{s=await async function(e,t){return[...new Set((await Promise.all(t.map(t=>l(e,t)))).flat())]}(n,a)}catch(e){throw new Error(`${p("The sitemap could not be parsed. Therefore, we cannot check for services on your website.")} ${t}`)}if(0===s.length)throw new Error(`${p("The sitemap is empty. So, we could not add any URLs to the scanner.")} ${t}`);return s}const m="rcb-scan",f={path:"/scanner/queue",method:t.RouteHttpVerb.POST},h={path:"/scanner/scan-without-login",namespace:"real-cookie-banner/v1",method:t.RouteHttpVerb.GET};let w=0;const y=jQuery;var b=e.n(y);(0,t.handleCorruptRestApi)({}),document.addEventListener(`${n.JOB_DELAY_EVENT_PREFIX}${m}`,({detail:{isIdle:e,settings:t}})=>{/page=real-cookie-banner(?:-pro)?-component#\/scanner/.test(window.location.href)||e?w>0&&w<t.delay_ms&&(t.delay_ms=w/2):t.delay_ms=3e3}),document.addEventListener(`${n.CLIENT_JOB_EVENT_PREFIX}${m}`,({detail:{job:{id:e,data:{url:o,isLoopback:r,allowFailure:a},process_total:s,group_position:i,group_total:c,group_uuid:l},resolve:u,reject:p,saveJobResult:d}})=>{const m=async o=>{const f=new URL(o),{searchParams:w}=f;"1"===w.get("rcb-scan")&&w.get("rcb-scan-job")===`${e}`||(0,t.applyQueryString)(f,[{"rcb-scan":`-${window.btoa(JSON.stringify((0,n.getConfigurableStatusParameters)()))}-`,"rcb-scan-job":e}],!0);const y=`<a href="${o}" target="_blank">${o}</a>`;try{let t,o,w,b="",g=!1,v=()=>Promise.resolve(""),_=!1,$="";if(r){const r=await(0,n.request)({location:h,params:{url:f.toString(),jobId:e}});({status:t,statusText:b,ok:o,redirected:_,responseUrl:$}=r),w=r.headers["content-type"]||void 0,v=()=>Promise.resolve(window.atob(r.body))}else{const e=await window.fetch(f.toString(),{mode:"no-cors"}),{type:n,headers:r}=e;({status:t,statusText:b,ok:o,redirected:_,url:$}=e),w=r.get("content-type")?.toLowerCase(),g="opaque"===n,v=()=>e.text()}_?m($):o||g?(await(0,n.fetchStatus)({from:"html",html:await v()}),!l||i!==c&&1!==i||(0,n.fetchStatus)(!0),g&&await d(e,s),w&&!w.startsWith("text/")&&await d(e,s),u()):[404,410].indexOf(t)>-1||a?(await d(e,s),u()):p({code:`invalid_response_${t}`,message:`${b} (${y})`})}catch(e){p({code:"unexpected",message:`${e.toString()} (${y})`})}},f=(new Date).getTime();(0,n.setCurrentlyFetchingStatus)(!0),m(o).finally(()=>{(0,n.setCurrentlyFetchingStatus)(!1),w=(new Date).getTime()-f})}),function(){const e=document.getElementById("rcb-scan-result-notice"),t=document.querySelector("#wp-admin-bar-rcb-scanner-found-services > a > span:nth-child(2)");let o=!1;document.addEventListener(n.STATUS_ADDITIONAL_DATA_EVENT,async({detail:{settings:{additionalData:t}}})=>{e&&o&&t.push("rcb-scan-notice")}),document.addEventListener(n.STATUS_EVENT,({detail:{currentJobs:{[m]:n},remaining:{[m]:r},additionalData:{"rcb-scan-notice":a}}})=>{let s=100;const i=r?.failure>0;if(r&&n?.group_position>0){const{remaining:e,total:t}=r;s=+((t-e)/t*100).toFixed(0)}const c=s>0&&s<100,l=document.getElementById("rcb-scanner-status"),u=document.getElementById("rcb-checklist-overdue");if(o=c,e&&a&&(e.innerHTML=a.text,t.innerHTML=t.innerHTML.replace(/\d+/,a.countAll.toString())),l){const e="none"!==l.style.display;if(l.innerHTML=`${s} %`,l.style.display=c?"inline-block":"none",u&&(u.style.display=c?"none":"inline-block"),e&&!c&&!i)try{const e=b()(['#real-cookie-banner-component .nav-tab[href="#/scanner"]:not(.nav-tab-active)','#real-cookie-banner-pro-component .nav-tab[href="#/scanner"]:not(.nav-tab-active)',"body:not(.toplevel_page_real-cookie-banner-component) #toplevel_page_real-cookie-banner-component","body:not(.toplevel_page_real-cookie-banner-pro-component) #toplevel_page_real-cookie-banner-pro-component"].join(",")),t=e.hasClass("nav-tab");e.pointer({content:`<h3>${p("Real Cookie Banner has scanned your website!")}</h3><p>${p('You may not have noticed, but we have been scanning your website in the background. View <a href="%s">scanner results</a> to obtain consent for used services from your website visitors!',`${t?"":e.find("a").attr("href")}#/scanner`)}</p>`,position:t?{edge:"top"}:{edge:"left",align:"bottom"},pointerClass:"wp-pointer arrow-"+(t?"top":"bottom"),pointerWidth:420});const n=e.pointer("widget");n.css({marginLeft:-10}),t&&n.find(".wp-pointer-arrow").css({marginLeft:-38}),e.pointer("open"),t&&e.add(n.find("a")).on("click",()=>{e.pointer("destroy")})}catch(e){}}})}(),document.addEventListener(`${n.CLIENT_JOB_EVENT_PREFIX}rcb-automatic-scan-starter`,async({detail:{job:{id:e,process_total:o},resolve:r,saveJobResult:a}})=>{let s;const i=setInterval(()=>{s=document.getElementById("rcb-btn-scan-start"),s&&(s.style.display="none")},1e3);try{const e=await d(),{restRoot:o,restNonce:r,restQuery:a}=window.realQueue,s={restRoot:o,restNamespace:"real-cookie-banner/v1",restNonce:r,restQuery:a};await(0,t.commonRequest)({location:f,options:s,request:{urls:e,purgeUnused:!0}}),await(0,n.refreshQueue)(),(0,n.fetchStatus)(!0)}catch(e){}finally{clearInterval(i),s&&s.style.removeProperty("display"),await a(e,o),r()}}),realCookieBanner_queue={}})();
//# sourceMappingURL=https://sourcemap.devowl.io/real-cookie-banner/5.2.14/093f2b34211e6e646339c2a30dc1accf/queue.lite.js.map
